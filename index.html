<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社会福祉士試験 頻出外国人名クイズ</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-green-500: rgba(34, 197, 94, 1);

            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-red-500-rgb: 192, 21, 47;
            --color-orange-500-rgb: 168, 75, 47;
            --color-green-500-rgb: 34, 197, 94;

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-green-500);
            --color-warning: var(--color-orange-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

            --font-family-base: "FKGroteskNieuwe", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;

            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;

            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        html {
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            line-height: var(--line-height-normal);
            color: var(--color-text);
            background-color: var(--color-background);
            -webkit-font-smoothing: antialiased;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
        }

        * {
            box-sizing: border-box;
        }

        h1, h2, h3 {
            margin: 0;
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
        }

        h1 { font-size: var(--font-size-3xl); }
        h2 { font-size: var(--font-size-2xl); }
        h3 { font-size: var(--font-size-lg); }

        p { margin: 0; }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
            border: none;
            text-decoration: none;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }

        .btn--primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn--primary:hover {
            background: var(--color-primary-hover);
        }

        .btn--full-width {
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-16);
        }

        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            box-shadow: var(--shadow-sm);
            padding: var(--space-24);
            margin-bottom: var(--space-20);
        }

        .hidden {
            display: none !important;
        }

        .header {
            text-align: center;
            margin-bottom: var(--space-32);
        }

        .header h1 {
            margin-bottom: var(--space-8);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--color-secondary);
            border-radius: var(--radius-base);
            overflow: hidden;
            margin-bottom: var(--space-16);
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-primary);
            transition: width var(--duration-normal) var(--ease-standard);
        }

        .question-number {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
        }

        .question-text {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-20);
            line-height: var(--line-height-normal);
        }

        .field-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-8);
            color: var(--color-text-secondary);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
            margin-bottom: var(--space-12);
        }

        .option-btn {
            padding: var(--space-12) var(--space-16);
            text-align: left;
            border: 2px solid var(--color-border);
            background-color: var(--color-surface);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-standard);
            font-size: var(--font-size-base);
            color: var(--color-text);
            width: 100%;
        }

        .option-btn:hover {
            border-color: var(--color-primary);
            background-color: rgba(var(--color-teal-500-rgb), 0.05);
        }

        .option-btn.correct {
            border-color: var(--color-success);
            background-color: rgba(var(--color-green-500-rgb), 0.15);
        }

        .option-btn.incorrect {
            border-color: var(--color-error);
            background-color: rgba(var(--color-red-500-rgb), 0.15);
        }

        .result-box {
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin-top: var(--space-8);
            margin-bottom: var(--space-8);
            border-left: 4px solid;
        }

        .result-box.correct {
            background-color: rgba(var(--color-green-500-rgb), 0.1);
            border-left-color: var(--color-success);
        }

        .result-box.incorrect {
            background-color: rgba(var(--color-red-500-rgb), 0.1);
            border-left-color: var(--color-error);
        }

        .result-text {
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-4);
        }

        .explanation {
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .score-summary {
            text-align: center;
            padding: var(--space-24);
        }

        .score-number {
            font-size: 32px;
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-8);
        }

        .score-text {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-16);
        }

        .category-badge {
            display: inline-block;
            background-color: var(--color-secondary);
            padding: var(--space-4) var(--space-12);
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-12);
        }

        .question-card {
            margin-bottom: var(--space-20);
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--space-12);
            }

            .card {
                padding: var(--space-16);
            }

            .score-number {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>社会福祉士試験 頻出外国人名クイズ</h1>
        <p style="color: var(--color-text-secondary); margin-top: var(--space-8);">
            30問すべてを一度に表示・各問題は回答後すぐに解答と解説を確認できます（正解位置は毎回ランダム）
        </p>
    </div>

    <div id="quiz-screen">
        <div class="card">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
            </div>
            <div class="question-number" id="question-number-top">回答済み 0 / 30</div>
            <div id="questions-container"></div>

            <div class="score-summary" style="border-top: 1px solid var(--color-card-border); margin-top: var(--space-16); padding-top: var(--space-16);">
                <div class="score-number" id="final-score">0/30</div>
                <div class="score-text" id="score-message">まずは各問題に回答してみましょう。</div>
                <button class="btn btn--primary btn--full-width" id="recalc-btn">
                    スコアを再計算する
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // 元データ（正解は index 0 を「正答」とみなしておき、後でランダム配置する）
    const rawQuizData = [
        {
            category: "相談援助技術",
            question: "ケースワークの科学的基礎を確立し、「慈善組織協会」で活動した人物は誰か？",
            correctOption: "M.リッチモンド",
            distractors: ["G.コイル", "バートレット", "パールマン"],
            explanation: "M.リッチモンド（Mary E. Richmond）はケースワークの母として知られ、科学的ケースワークの確立に貢献しました。"
        },
        {
            category: "相談援助技術",
            question: "グループワークを理論的に体系化し、集団援助技術教育課程を創立した人物は誰か？",
            correctOption: "G.コイル",
            distractors: ["M.リッチモンド", "ホリス", "パールマン"],
            explanation: "G.コイル（Grace Coyle）はグループワークの母として、アメリカで初めての集団援助技術教育課程を創立しました。"
        },
        {
            category: "障害者福祉",
            question: "ノーマライゼーションの理念を提唱し、障害者が通常の生活を営める支援体制を構築した人物は誰か？",
            correctOption: "バンク・ミケルセン",
            distractors: ["コルチャック", "アダムス", "ティトマス"],
            explanation: "N.E.バンク・ミケルセン（Niels Erik Bank-Mikkelsen）はデンマークでノーマライゼーションの理念を提唱し、脱施設化運動を推進しました。"
        },
        {
            category: "相談援助技術",
            question: "問題解決アプローチをケースワークに導入し、「ケースワークは死んだ」という言葉で新しい方法論の必要性を主張した人物は誰か？",
            correctOption: "パールマン",
            distractors: ["ホリス", "M.リッチモンド", "バートレット"],
            explanation: "Helen Harris Perlman（パールマン）は問題解決アプローチを提唱し、クライエントを自分の課題を解決できる存在として捉えました。"
        },
        {
            category: "相談援助技術",
            question: "心理社会的アプローチを確立し、「状況のなかの人（Person-in-Situation）」という概念を重視した人物は誰か？",
            correctOption: "ホリス",
            distractors: ["パールマン", "バートレット", "ソロモン"],
            explanation: "Florence Hollis（ホリス）は心理社会的アプローチを確立し、クライエントの心理的側面と社会的環境の両方への介入を強調しました。"
        },
        {
            category: "心理学理論",
            question: "精神分析学を創始し、無意識の概念を導入した人物は誰か？",
            correctOption: "フロイト",
            distractors: ["エリクソン", "オールポート", "バンデューラ"],
            explanation: "Sigmund Freud（フロイト）は精神分析学の創始者で、人間心理の理論と治療技法を体系化しました。"
        },
        {
            category: "発達理論",
            question: "乳幼児期から老年期までの8つの発達段階論を提唱した人物は誰か？",
            correctOption: "エリクソン",
            distractors: ["フロイト", "ゲゼル", "バンデューラ"],
            explanation: "Erik H. Erikson（エリクソン）は各段階での心理社会的課題を提示し、発達段階と社会的課題の関連を強調しました。"
        },
        {
            category: "社会理論",
            question: "社会的行為を4つに分類（目的合理的、価値合理的、感情的、伝統的）し、官僚制論を展開した人物は誰か？",
            correctOption: "ウェーバー",
            distractors: ["テンニース", "ジンメル", "オグバーン"],
            explanation: "Max Weber（ウェーバー）は社会学の巨人で、4つの社会的行為の分類が試験頻出の重要な概念です。"
        },
        {
            category: "社会保障政策",
            question: "1942年に「ベヴァリッジ報告」を出版し、現代的社会保障制度の基礎を構想した人物は誰か？",
            correctOption: "ベヴァリッジ",
            distractors: ["ティトマス", "ウィレンスキー", "ラウントリー"],
            explanation: "William Beveridge（ベヴァリッジ）は社会保障を国家が国民に対して権利として与える制度として提唱し、福祉国家の思想的基礎を構築しました。"
        },
        {
            category: "社会調査",
            question: "ヨークの貧困調査を3回実施し、貧困の客観的測定方法を開発した人物は誰か？",
            correctOption: "ラウントリー",
            distractors: ["ウェッブ夫妻", "アダムス", "ティトマス"],
            explanation: "B. Seebohm Rowntree（ラウントリー）は貧困ラインの概念を導入し、貧困は貧困者の責任ではなく構造的原因があることを実証しました。"
        },
        {
            category: "相談援助技術",
            question: "ソーシャルワーク実践の共通要素として、価値・知識・介入（スキル）の3要素論を提唱した人物は誰か？",
            correctOption: "バートレット",
            distractors: ["ソロモン", "M.リッチモンド", "パールマン"],
            explanation: "Barbara Bartlett（バートレット）はジェネラリストアプローチの基礎を構築し、ソーシャルワークの共通要素を体系化しました。"
        },
        {
            category: "相談援助技術",
            question: "エンパワメント概念を社会福祉に導入し、抑圧されている人々の力の回復を強調した人物は誰か？",
            correctOption: "ソロモン",
            distractors: ["バートレット", "パールマン", "ホリス"],
            explanation: "Barbara Solomon（バーバラ・ソロモン）はエンパワメント概念を導入し、社会的抑圧と個人的無力感の関連を分析しました。"
        },
        {
            category: "家族社会学",
            question: "構造機能主義社会学を創始し、家族の2機能説（感情的・表出的機能と道具的・適応的機能）を提唱した人物は誰か？",
            correctOption: "パーソンズ",
            distractors: ["オグバーン", "テンニース", "ウェーバー"],
            explanation: "Talcott Parsons（パーソンズ）は社会秩序と統合を重視する理論枠組みを構築し、家族機能論の基礎を確立しました。"
        },
        {
            category: "心理学",
            question: "16性格因子（16PF）を開発し、性格特性を因子分析で研究した人物は誰か？",
            correctOption: "キャッテル",
            distractors: ["ゴールドバーグ", "クレッチマー", "オールポート"],
            explanation: "Raymond B. Cattell（キャッテル）は性格特性の実証的測定法を確立し、日本ではYG性格検査の基礎となりました。"
        },
        {
            category: "心理学",
            question: "ビッグファイブ（5大特性）パーソナリティ理論を提唱し、性格測定の普遍的枠組みを構築した人物は誰か？",
            correctOption: "ゴールドバーグ",
            distractors: ["キャッテル", "オールポート", "クレッチマー"],
            explanation: "Lewis R. Goldberg（ゴールドバーグ）は神経症傾向、外向性、経験への開放性、調和性、誠実性の5因子を特定しました。"
        },
        {
            category: "医学心理学",
            question: "体質と気質の関連性を研究し、肥満型は躁鬱質、細長型は統合失調質と分類した人物は誰か？",
            correctOption: "クレッチマー",
            distractors: ["セリエ", "オールポート", "バンデューラ"],
            explanation: "Ernst Kretschmer（クレッチマー）は体質論と精神疾患の関連を提示し、医学心理学の発展に貢献しました。"
        },
        {
            category: "心理学",
            question: "一般適応症候群（GAS）を提唱し、ストレスの生物学的反応を警告反応・抵抗・疲弊の3段階で説明した人物は誰か？",
            correctOption: "セリエ",
            distractors: ["フロイト", "エリクソン", "バンデューラ"],
            explanation: "Hans Selye（セリエ）はストレス研究の基礎を確立し、現代のストレス理論の基盤を作りました。"
        },
        {
            category: "心理学",
            question: "特性心理学（trait psychology）を確立し、パーソナリティ心理学を体系化した人物は誰か？",
            correctOption: "オールポート",
            distractors: ["キャッテル", "ゴールドバーグ", "バンデューラ"],
            explanation: "Gordon Allport（オールポート）は性格特性の分類に因子分析を初めて導入し、近現代パーソナリティ心理学の基礎を構築しました。"
        },
        {
            category: "児童福祉",
            question: "孤児院を運営して児童中心教育を実践し、児童の権利と尊厳を強く主張した人物は誰か？",
            correctOption: "コルチャック",
            distractors: ["エレン・ケイ", "アダムス", "ゲゼル"],
            explanation: "Janusz Korczak（ヤヌシュ・コルチャック）は「世界の児童福祉の父」と称され、児童の権利を強く主張した先駆者です。"
        },
        {
            category: "社会保障政策",
            question: "ベヴァリッジの福祉国家理論を継承・発展させ、社会保障の3つの供給体制（残余的・制度的・社会的）を提唱した人物は誰か？",
            correctOption: "ティトマス",
            distractors: ["ベヴァリッジ", "ウィレンスキー", "ラウントリー"],
            explanation: "Richard Titmuss（リチャード・ティトマス）はイギリスのNHS理論的基礎を構築し、福祉国家の理論を深化させました。"
        },
        {
            category: "社会保障政策",
            question: "『福祉国家と平等』を著述し、福祉国家供給体制を分類したウィレンスキー・ルボー理論を展開した人物は誰か？",
            correctOption: "ウィレンスキー",
            distractors: ["ティトマス", "ベヴァリッジ", "ラウントリー"],
            explanation: "Harold L. Wilensky（ウィレンスキー）は福祉国家修練説を唱え、産業社会と福祉の関係を分析しました。"
        },
        {
            category: "社会学",
            question: "都市社会の特性を分析し、小集団（プライマリーグループ）の重要性を強調した人物は誰か？",
            correctOption: "ジンメル",
            distractors: ["テンニース", "ウェーバー", "オグバーン"],
            explanation: "Georg Simmel（ジンメル）は現代的人間関係の変化を研究し、都市社会学の開拓者として知られています。"
        },
        {
            category: "家族社会学",
            question: "家族機能縮小説を提唱し、近代化に伴う家族機能の変化を分析した人物は誰か？",
            correctOption: "オグバーン",
            distractors: ["パーソンズ", "テンニース", "ウェーバー"],
            explanation: "William Ogburn（ウィリアム・オグバーン）は家族の多くの機能が他の社会制度に移行することを指摘しました。"
        },
        {
            category: "社会調査",
            question: "フェビアン協会の中心メンバーとして、社会科学的手法による社会調査を実施した夫妻は誰か？",
            correctOption: "シドニー・ウェッブ夫妻",
            distractors: ["ラウントリー", "アダムス", "ウェッブ"],
            explanation: "Sidney Webb & Beatrice Webb（シドニー・ウェッブ夫妻）はイギリスの社会政策形成に大きな影響を与えました。"
        },
        {
            category: "社会福祉",
            question: "アメリカで初めてのセツルメント「ハル・ハウス」を創設し、貧困地域での支援活動を展開した人物は誰か？",
            correctOption: "アダムス",
            distractors: ["コルチャック", "エレン・ケイ", "ベヴァリッジ"],
            explanation: "Jane Addams（ジェーン・アダムス）はセツルメント運動の提唱者で、ソーシャルワークの実践的基礎を構築し、ノーベル平和賞を受賞しました。"
        },
        {
            category: "児童心理学",
            question: "児童の発達段階を観察・記録し、発達規範（developmental norms）を確立した人物は誰か？",
            correctOption: "ゲゼル",
            distractors: ["コルチャック", "エリクソン", "エレン・ケイ"],
            explanation: "Arnold Lucius Gesell（ゲゼル）は映像記録を用いた発達研究の先駆者で、児童心理学の科学化に貢献しました。"
        },
        {
            category: "慈善活動",
            question: "「神の愛の宣教者会」を創設し、インドの貧困者や病者への献身的活動を展開した人物は誰か？",
            correctOption: "マザー・テレサ",
            distractors: ["アダムス", "コルチャック", "エレン・ケイ"],
            explanation: "マザー・テレサ（聖テレサ・オブ・カルカッタ）は宗教を超えた人道的支援を実践し、ノーベル平和賞を受賞しました。"
        },
        {
            category: "児童福祉",
            question: "児童の権利と教育の重要性を強調し、「児童の世紀」を著述した人物は誰か？",
            correctOption: "エレン・ケイ",
            distractors: ["コルチャック", "アダムス", "ゲゼル"],
            explanation: "Ellen Key（エレン・ケイ）はスウェーデンの改革者で、教育を通じた社会改革を提唱し、女性解放運動を牽引しました。"
        },
        {
            category: "社会学",
            question: "ゲマインシャフト（共同体）とゲゼルシャフト（利益社会）の概念を提唱し、コミュニティ理論の基礎を構築した人物は誰か？",
            correctOption: "テンニース",
            distractors: ["ジンメル", "ウェーバー", "オグバーン"],
            explanation: "Ferdinand Tönnies（テンニース）は近代化に伴う社会関係の変化を分析し、コミュニティ理論の基礎を確立しました。"
        },
        {
            category: "システム理論",
            question: "一般システム理論を創設し、システムの全体性と相互関係を強調した人物は誰か？",
            correctOption: "ベルタランフィ",
            distractors: ["バンデューラ", "セリエ", "ウェーバー"],
            explanation: "Ludwig von Bertalanffy（ベルタランフィ）はソーシャルワークのシステム的理解の基礎を構築しました。"
        },
        {
            category: "学習理論",
            question: "社会学習理論を提唱し、観察学習と自己効力感（self-efficacy）の概念を導入した人物は誰か？",
            correctOption: "バンデューラ",
            distractors: ["オールポート", "フロイト", "エリクソン"],
            explanation: "Albert Bandura（バンデューラ）は人間の認知と行動の関係を強調し、セラピーやカウンセリングに大きな影響を与えました。"
        },
        {
            category: "組織心理学",
            question: "X理論とY理論を提唱し、人間のモチベーションと管理の関係を分析した人物は誰か？",
            correctOption: "マグレガー",
            distractors: ["バンデューラ", "セリエ", "オールポート"],
            explanation: "Douglas McGregor（ダグラス・マグレガー）はソーシャルワークの組織運営にも応用可能な理論を提唱しました。"
        }
    ];

    // 正解位置をランダムにした quizData を生成
    function shuffleArray(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    const quizData = rawQuizData.map(q => {
        const allOptions = [q.correctOption, ...q.distractors];
        const shuffled = shuffleArray(allOptions);
        const correctIndex = shuffled.indexOf(q.correctOption);
        return {
            category: q.category,
            question: q.question,
            options: shuffled,
            correct: correctIndex,
            explanation: q.explanation
        };
    });

    let answeredState = new Array(quizData.length).fill(false);
    let selectedAnswers = new Array(quizData.length).fill(null);

    function renderAllQuestions() {
        const container = document.getElementById('questions-container');
        container.innerHTML = '';

        quizData.forEach((quiz, index) => {
            const card = document.createElement('div');
            card.className = 'question-card';

            const qNumber = document.createElement('div');
            qNumber.className = 'question-number';
            qNumber.textContent = `問題 ${index + 1} / ${quizData.length}`;

            const badge = document.createElement('div');
            badge.className = 'category-badge';
            badge.textContent = quiz.category;

            const qText = document.createElement('div');
            qText.className = 'question-text';
            qText.textContent = quiz.question;

            const label = document.createElement('div');
            label.className = 'field-label';
            label.textContent = '選択肢を選んでください';

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options';

            quiz.options.forEach((opt, optIndex) => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.addEventListener('click', () => handleSelect(index, optIndex));
                optionsDiv.appendChild(btn);
            });

            const resultBox = document.createElement('div');
            resultBox.id = `result-box-${index}`;
            resultBox.className = 'result-box hidden';

            const resultText = document.createElement('div');
            resultText.id = `result-text-${index}`;
            resultText.className = 'result-text';

            const explanation = document.createElement('div');
            explanation.id = `explanation-${index}`;
            explanation.className = 'explanation';

            resultBox.appendChild(resultText);
            resultBox.appendChild(explanation);

            card.appendChild(qNumber);
            card.appendChild(badge);
            card.appendChild(qText);
            card.appendChild(label);
            card.appendChild(optionsDiv);
            card.appendChild(resultBox);

            container.appendChild(card);
        });
    }

    function handleSelect(qIndex, optIndex) {
        if (answeredState[qIndex]) return;

        selectedAnswers[qIndex] = optIndex;
        answeredState[qIndex] = true;

        const quiz = quizData[qIndex];
        const card = document.getElementsByClassName('question-card')[qIndex];
        const optionButtons = card.querySelectorAll('.option-btn');

        optionButtons.forEach((btn, index) => {
            btn.disabled = true;
            if (index === quiz.correct) {
                btn.classList.add('correct');
            }
            if (index === optIndex && index !== quiz.correct) {
                btn.classList.add('incorrect');
            }
        });

        const isCorrect = optIndex === quiz.correct;
        const resultBox = document.getElementById(`result-box-${qIndex}`);
        const resultText = document.getElementById(`result-text-${qIndex}`);
        const explanation = document.getElementById(`explanation-${qIndex}`);

        if (isCorrect) {
            resultBox.className = 'result-box correct';
            resultText.textContent = '✓ 正解！';
        } else {
            resultBox.className = 'result-box incorrect';
            resultText.textContent = `✗ 不正解（正解：${quiz.options[quiz.correct]}）`;
        }
        explanation.textContent = quiz.explanation;
        resultBox.classList.remove('hidden');

        recalcScore();
    }

    function recalcScore() {
        let score = 0;
        let answeredCount = 0;

        quizData.forEach((quiz, index) => {
            if (answeredState[index]) {
                answeredCount++;
                if (selectedAnswers[index] === quiz.correct) {
                    score++;
                }
            }
        });

        const percent = Math.round((score / quizData.length) * 100);
        document.getElementById('final-score').textContent = `${score}/${quizData.length}`;
        document.getElementById('question-number-top').textContent =
            `回答済み ${answeredCount} / ${quizData.length}`;
        document.getElementById('progress-fill').style.width =
            `${(answeredCount / quizData.length) * 100}%`;

        const msgEl = document.getElementById('score-message');
        if (answeredCount === 0) {
            msgEl.textContent = 'まずは各問題に回答してみましょう。';
        } else if (percent >= 80) {
            msgEl.textContent = `excellent！合格基準クリア！（正答率 ${percent}%）`;
        } else if (percent >= 60) {
            msgEl.textContent = `及第点です。弱い人物を重点的に復習しましょう。（正答率 ${percent}%）`;
        } else {
            msgEl.textContent = `まだ伸びしろがあります。間違えた人物を中心に覚え直しましょう。（正答率 ${percent}%）`;
        }
    }

    document.getElementById('recalc-btn').addEventListener('click', recalcScore);

    renderAllQuestions();
    recalcScore();
</script>
</body>
</html>
